# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure('2') do |config|
    config.vm.box = 'ubuntu/xenial64'
    config.ssh.keys_only = false
    config.ssh.insert_key = false

    config.vm.define 'web', primary: true do |web|
        web.vm.network 'forwarded_port', guest: 80, host: 5230
        web.vm.network 'private_network', type: 'dhcp'
        web.vm.synced_folder '../../', '/var/www/get-native.com/development/current/', type: 'nfs'
        web.vm.provision 'chef_solo' do |chef|
            chef.cookbooks_path = %w(../cookbooks ../site-cookbooks)
            chef.data_bags_path = '../data_bags'
            chef.environments_path = '../environments'
            chef.environment = 'dev'
            chef.roles_path = '../roles'
            chef.add_recipe 'get-native.com-cookbook::web-server'
            chef.json = {
                    'get-native' => {
                            'server_port' => 80,
                            'server_name' => 'localhost:80'
                    }
            }
        end
    end

    config.vm.define 'db' do |db|
        db.vm.network 'private_network', type: 'dhcp'
        db.vm.provision 'chef_solo' do |chef|
            chef.cookbooks_path = %w(../cookbooks ../site-cookbooks)
            chef.data_bags_path = '../data_bags'
            chef.environments_path = '../environments'
            chef.environment = 'dev'
            chef.roles_path = '../roles'
            chef.add_recipe 'get-native.com-cookbook::db-server'
        end
    end
end

# Note: The default `vagrant ssh` command is not working for this setup right now. To login directly to the box,
#       use the following ssh command:
#
#       ssh ubuntu@127.0.0.1 -p 2222 -o "UserKnownHostsFile /dev/null" -o "StrictHostKeyChecking no"
#                                    -o "PasswordAuthentication no" -o "IdentitiesOnly yes" -o "LogLevel FATAL"
#                                    -o "IdentityFile {file location}"
